# M10：関係のない機能

<table>
 <tr>
  <th>脅威エージェント</th>
  <th>攻撃経路</th>
  <th colspan="2">セキュリティ上の弱点</th>
  <th>技術的な影響</th>
  <th>ビジネスへの影響</th>
 </tr>
 <tr>
  <td>アプリケーション依存 </td>
  <td>攻撃難易度：容易</td>
  <td>普及度：中</td>
  <td>検出難易度：中</td>
  <td>中程度の影響</td>
  <td>アプリケーション / ビジネス依存</td>
 </tr>
 <tr>
  <td>バックエンドシステムの隠し機能を見つけるために、通常、攻撃者はモバイルアプリ内の関係のない機能を理解しようとします。攻撃者は通常、エンドユーザの関与無しに攻撃者自身のシステムから直接関係のない機能を悪用するでしょう。</td>
  <td> 攻撃者はモバイルアプリを攻撃者自身のローカル環境にダウンロードして調査します。攻撃者は開発者によって残された隠しスイッチやテストコードを見つけるためにログファイル、設定ファイル、そしておそらくバイナリ自体も調査します。攻撃者は攻撃を実行するために、これらのスイッチやバックエンドシステムの隠し機能を悪用するでしょう。</td>
  <td colspan="2">モバイルアプリがインターフェースで直接ユーザに公開していない関係のない機能を含んでいる可能性は高いです。この追加のコードのほとんどは、本質的に無害で、攻撃者にバックエンド機能のさらなる洞察を与えるものではありません。しかしながら、関係のない機能の中には、攻撃者にとても有益なものがあります。バックエンドのテスト、デモ、ステージング環境やUAT環境の情報を公開する機能は、プロダクションビルドに含まれるべきではありません。加えて、管理者用のAPIエンドポイントや非公式のエンドポイントは、最終的なプロダクションビルドに含まれるべきではありません。関係のない機能を検出することは難しいです。自動化された静的/動的解析ツールは、簡単に見つけることができるもの(ログ・ステートメント)を検出することができます。しかしながら、バックドアの中には自動化の手段では検出することが難しいものがあります。したがって、手動のコードレビューを利用してこれらを防ぐことが最善です。</td><td>関係のない機能による技術的影響は以下です。
  <lu>
   <li> バックエンドシステムがどのように動作するかについての情報の漏洩</li>
   <li>高い権限を有するアクションの不正実行</li>
  </lu>
  </td>
  <td>関係のない機能によるビジネスへの影響は以下です。
   <ul>
    <li> 機密機能への不正アクセス</li>
    <li> 風評被害</li>
    <li>知的財産の窃盗</li>
   </ul>
  </td>
 </tr>
</table>



## 脆弱性有無の確認
しばしば、開発者は本番環境にリリースするつもりのない隠しバックドア機能や内部開発用のセキュリティコントールを含めてしまいます。例えば、開発者はハイブリッドアプリ内にパスワードをうっかり含めてしまうかもしれません。他の例は、テスト中に二要素認証を無効化していたままで含めてしまうことがあります。
本リスクの重要な特徴は、リリースするつもりではない機能をアプリで有効にしたままにしてしまうことです。


## 防止方法
本脆弱性を防止する最も良い方法は、セキュリティに一番詳しい人や該当のコードについて最も詳しい専門家に手動のセキュアコードレビューを実施してもらうことです。彼らは以下を実施する必要があります。
 1. 隠しスイッチを見つけるためにアプリの設定を調査する
 2. 全てのテストコードがアプリの最終のプロダクションビルドに含まれていないことを検証する
 3. モバイルアプリによってアクセスされる全てのAPIエンドポイントを調査して、それらのエンドポイントについて十分にドキュメント化され、一般公開されているかどうかを検証する
 4. バックエンドについて過剰な記述がログに書き出されていないかを確認するために、全てのログ・ステートメントを調査する


## 攻撃シナリオの例
**シナリオ# 1：** 管理者用エンドポイントの公開<br>
モバイルエンドポイントへのテストの一部として、開発者は管理者向けダッシュボードを表示する隠しインターフェースをモバイルアプリ内に含めました。このダッシュボードは、バックエンドAPIサーバを経由して管理者情報にアクセスしていました。プロダクション用バージョンのコード内に、開発者はこのダッシュボードを表示するコードは含めませんでした。しかしながら、バックエンドの管理者用APIにアクセス可能なコードが含まれていました。攻撃者は、バイナリのストリングテーブル解析を実施し、管理者向けRESTエンドポイントのハードコードされたURLを見つけました。次に攻撃者は「curl」を使用し、バックエンドの管理者機能を実行しました。
開発者は、ネイティブインターフェースから直接アクセスできないコードを含め関係のない全てのコードを削除すべきです。
 
**シナリオ #2：** 設定ファイル内のデバッグフラグ<br>
攻撃者はローカルアプリ内の「.properties」ファイルに「debug=true」を手動で追加しました。起動時に、アプリケーションは、攻撃者がバックエンドシステムを理解するために役立つ過剰な記述をログファイルに出力します。そのログの結果から、攻撃者はバックエンドシステム内の脆弱性を見つけます。
開発者はモバイルアプリのプロダクションビルドで「デバッグモード」が有効化されることを防ぐべきです。

## 参考資料
### OWASP
 - [OWASP](https://www.owasp.org/)
 
### 外部リンク
 - [CWE-Common Weakness Enumeration](http://cwe.mitre.org/)
