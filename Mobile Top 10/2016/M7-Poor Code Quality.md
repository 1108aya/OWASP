# M7：クライアントコードの品質

<table>
 <tr>
  <th>脅威エージェント</th>
  <th>攻撃経路</th>
  <th colspan="2">セキュリティ上の弱点</th>
  <th>技術的な影響</th>
  <th>ビジネスへの影響</th>
 </tr>
 <tr>
  <td align="center" width="20%">アプリケーション依存 </td>
  <td align="center" width="15%">攻撃難易度<br>困難</td>
  <td align="center" width="15%">普及度<br>中</td>
  <td align="center" width="15%">検出難易度<br>困難</td>
  <td align="center" width="17.5%">影響度<br>中</td>
  <td align="center" width="17.5%">アプリケーション / ビジネス依存</td>
 </tr>
 <tr>
  <td>脅威エージェントは、モバイルコード内で生成されたメソッド呼び出しに信頼できない入力値を渡すことが可能なエンティティです。これらの種類の問題は、必ずしもそれ自身がセキュリティ問題だとは言えませんが、セキュリティ脆弱性の原因となります。例えば、古いバージョンのSafar(コード品質不備の脆弱性がある)に存在するバッファオーバーフローは、高いリスクのドライブバイJailbreak攻撃をもたらしました。コード品質不備の問題は通常、マルウェアやフィッシング詐欺で悪用されます。</td>
  <td>攻撃者は通常、慎重に作成された入力値を被害者に送信することによって本カテゴリの脆弱性を悪用します。これらの入力値は、攻撃が実行されるモバイルデバイス内のコードへ渡されます。典型的な種類の攻撃は、メモリリークとバッファオーバーフローを悪用するでしょう。</td>
  <td colspan="2">コード品質の問題は、モバイルコードのほとんどでかなりよく見られます。良いニュースは、ほとんどのコード品質の問題はかなり無害であり、プログラミングの悪いプラクティスということで終わります。通常、マニュアルのコードレビューでは、こういった種類の問題を検出することが難しいです。攻撃者はサードパーティの静的解析やファジングを実施するツールを使用します。これらの種類のツールは、プログラミングの悪いプラクティスであるメモリリーク、バッファオーバーフロー、その他のそれほど深刻ではない問題を見つけます。極端に低レベルの知識と技術を持つハッカーは、これらの種類の問題を効果的に悪用することができます。典型的な主な目標は、モバイルコードのアドレス空間で外部コードを実行することです。</td>
  <td>本カテゴリに分類されるほとんどの攻撃は、外部コードの実行やリモートのサーバエンドポイント上(モバイルデバイス自身ではない)のサービス拒否(DoS)の結果となります。しかしながら、モバイルデバイス内に、バッファオーバーフロー/オーバーランが存在し、入力値が外部パーティから派生する場合、かなり深刻な技術的影響がある可能性があり、修正されるべきです。</td>
  <td>本カテゴリの脆弱性によるビジネスへの影響は、エクスプロイトの性質によって、非常に広範囲に及びます。リモートコード実行となるコード品質不備の問題は、以下のようなビジネスへの影響につながる可能性があります。
   <ul>
    <li> 情報の窃取</li>
    <li> 風評被害</li>
    <li> 知的財産の窃盗</li>
   </ul>
   本カテゴリに分類されるその他の深刻度が低い技術的な問題は、パフォーマンス、メモリ使用の低下や、フロントエンドのアーキテクチャの不備につながるかもしれません。
  </td>
 </tr>
</table>



## 脆弱性有無の確認
本カテゴリは、モバイルクライアントのコードレベルの実装問題を包括します。サーバサイドのコーディングミスとは異なります。本カテゴリは、モバイルデバイスで動いているコードを書き換えることで解決するバッファオーバーフロー、フォーマットスリング、その他のコードレベルのミスといった脆弱性がもたらすリスクを含みます。
プログラミング言語自体(たとえば、Java、Swift、Objective C、JavaScript)を参照するため、M1(Improper Platform Usage：不適切なプラットフォームの使用)とは異なります。WebViewのモバイルアプリにおけるC言語のバッファオーバーフローもしくはDOM-based XSSはコード品質問題です。
本リスクの重要な特徴は、モバイルデバイス上でコードが実行されることであり、コードを局所的に変更する必要があることです。ほとんどのリスクを修正するにはコード変更が必要ですが、本コード品質の場合、間違ったAPIの使用、APIの安全でない使用、安全でない言語コンストラクトの使用、その他のコードレベルの問題によってリスクが発生します。重要なことは、サーバ上で実行するコードではく、モバイルデバイス自体で実行される悪いコードによってもたらされるリスクであるということです。


## 防止方法
一般的にコード品質問題は、以下を実施することによって回避することが可能です。
 - 組織の全員が合意する一貫したコーディングパターンを維持すること。
 - 読みやすく、十分にドキュメントされているコードを書くこと。
 - バッファを使用するときは、受信するバッファデータの長さがターゲットバッファの長さを超えていないか常に検証すること。
 - 自動化によって、サードパーティの静的解析ツールを使用してバッファオーバーフローとメモリリークを見つけること。
 - その他の「コード品質」問題より、バッファオーバーフローやメモリリークの解決を優先すること。
 

## 攻撃シナリオの例
**シナリオ #1：** バッファオーバーフローの例

```
include <stdio.h>
int main(int argc, char **argv){
    char buf[8];    // buffer for eight characters
    gets(buf);    // read from stdio (sensitive function!)
    printf("%s\n", buf);    // print out data stored in buf
    return 0;    // 0 as return value
}
```
[このページ](https://www.owasp.org/index.php/Buffer_overflow_attack)から取得した本例は、私達はバッファオーバーフローを防ぐためにgets関数の使用を避けるべきです。これはほとんどの静的解析ツールがコード品質問題として報告する例です。


## 参考資料
### OWASP
 - [Buffer Overflow Examples](https://www.owasp.org/index.php/Buffer_overflow_attack)

### その他 
 - [外部参照](http://cwe.mitre.org/)
